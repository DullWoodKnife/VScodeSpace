# 数据库连接查询

```
use web_01;
# 例1:查询前3行男生信息：
select *
from students
where gender = '男'
limit 0, 3;

select *
from students
where gender = '男'
limit 3;

# 根据已知每页显示m数据, 求第n页显示的数据
# 关键是求每一页的开始行索引
# (n-1)*m, m
# select * from students limit (n-1)*m, m

# 例子: 返回非Null数据的总行数
select count(height)
from students;

# 返回总行数, 包含null值记录;
select count(*)
from students;

# 查询女生编号最大值
select max(id)
from students
where gender = '女';
select max(id)
from students
where gender = '女';

#  查询未删除的学生最小编号
select min(id)
from students
where students.is_del = 0;

# --查询男生的总身高
select sum(height)
from students
where gender = '男';

# 平均身高
select sum(height) / count(*)
from students
where gender = '男';

# 求男生的平均身高， 聚合是不统计null值, 平均身高有误;
select avg(height)
from students
where gender = '男';

# 求男生的平均身高，包含身高是null的
# ifnull函数: 表示判断指定字段的值是否为null, 如果为空使用自己提供的值.
select avg(ifnull(height, 0))
from students
where gender = '男';

# 分组查询
# 1.group by 列名[having 条件表达式] [with rollup]
# 列名： 是指按照指定字段的值进行分组
# having 条件表达式: 用来过滤分组后的数据
# with rollup：在所有记录的最后加上一条记录，显示select查询时聚合函数统计和计算结果

# group by的使用
# group by可用于单个字段分组, 也可以使用多个字段分组
# 例1：根据gender字段来分组
select gender
from students
group by gender;
# 根据name和gender字段进行分组
select name, gender
from students
group by name, gender;

# group by + group_concat()的使用
# group_concat(字段名): 统计每个分组指定字段的信息集合，每个信息之间使用逗号分割
# 例1：根据gender字段进行分组， 查询gender字段和分组的name字段信息
select gender, group_concat(name)
from students
group by gender;

# + 聚合函数使用
# 统计不同性别的人的平均年龄
select gender, avg(age)
from students
group by gender;

# 统计不同性别的人的个数
select gender, count(*)
from students
group by gender;


# having 作用和where类似都是过滤数据的，但是having是过滤分组数据的，只能用group by
# 例1： 根据gender字段进行分组，统计分组条数大于2的
# select gender ,count(*) from students group by gender having count(*) > 1;
#
# select gender, avg(age) from students group by gender having avg(age) < 27;

# 如何将新添加的字段排到前面已经建完的字段位置处
# alter table students add weight varchar(255) after name ;

# alter table students drop weight;

# 根据gender字段进行分组，汇总总人数
select gender, count(*)
from students
group by gender
with rollup;

# 根据gender字段进行分组，汇总所有人的年龄
select gender, group_concat(age)
from students
group by gender
with rollup;

# 创建部门表
create table tb_dept
(
    dept_id   tinyint primary key auto_increment not null,
    dept_name varchar(255)
);

# 创建员工表
create table tb_emp
(
    emp_id     tinyint primary key auto_increment not null,
    emp_name   varchar(255),
    emp_gender enum ('男', '女') default '男',
    dept       tinyint
);

# 工资表
create table tb_salary
(
    salary_id  tinyint primary key auto_increment not null,
    salary_sum tinyint,
    salary_tax tinyint
);

insert into tb_dept
values (0, '研发中心'),
       (0, '市场中心'),
       (0, '行政中心'),
       (0, '后勤中心');

insert into tb_emp
values (0, '张三丰', default, 1),
       (0, '宋远桥', default, 1),
       (0, '俞莲舟', default, 1),
       (0, '张松溪', default, 2),
       (0, '张翠山', default, 2),
       (0, '殷梨亭', default, 2),
       (0, '宋青书', default, 3),
       (0, '张无忌', default, 3),
       (0, '莫声谷', default, 3),
       (0, '俞岱岩', default, 4);


# 多表关联的sql 分为四步： 1.确定要连接的表；2.确定要查询的字段 3.确定连接方式 4.确定关联条件
# 查询所有部门及其下面的员工
# 部门表查询员工表
select td.dept_id, td.dept_name, te.dept
from tb_dept td
         inner join tb_emp te on td.dept_id = te.dept;

# 通过员工表查询部门
# 1.确定要连接的表；
# 2.确定要查询的字段  通过员工找到部门  员工名字， 员工的dept 部门的名字(id)
select tb_emp.emp_id, tb_emp.emp_name, tb_emp.emp_gender, tb_emp.dept, tb_dept.dept_id, tb_dept.dept_name
from tb_emp
         inner join tb_dept on tb_emp.dept = tb_dept.dept_id;
```